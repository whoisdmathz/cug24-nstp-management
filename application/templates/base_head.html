<!DOCTYPE html>

<html
  lang="en"
  class="light-style layout-navbar-fixed layout-menu-fixed"
  dir="ltr"
  data-theme="theme-default"
  data-assets-path=""
  data-template="vertical-menu-template-no-customizer"
>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />

    <title>{% block title %}Dashboard{% endblock %} — ASSCAT NSTP Management System</title>

    <meta name="description" content="" />

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='img/logo.png') }}" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Rubik:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet" />

    <!-- Icons -->
    <link rel="stylesheet" href="{{ url_for('static', filename='vendor/fonts/boxicons.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='vendor/fonts/fontawesome.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='vendor/fonts/flag-icons.css') }}" />

    <!-- Core CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='vendor/css/rtl/core.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='vendor/css/rtl/theme-default.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/demo.css') }}" />

    <!-- Vendors CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='vendor/libs/perfect-scrollbar/perfect-scrollbar.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='vendor/libs/typeahead-js/typeahead.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='vendor/libs/datatables-bs5/datatables.bootstrap5.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='vendor/libs/datatables-buttons-bs5/buttons.bootstrap5.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='vendor/libs/sweetalert2/sweetalert2.css') }}" />


    <!-- Page CSS -->

    <!-- Helpers -->
    <script src="{{ url_for('static', filename='vendor/js/helpers.js') }}"></script>

    <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
    <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
    <script src="{{ url_for('static', filename='js/config.js') }}"></script>

    <!-- Dark -->
    <link rel="stylesheet" href="{{ url_for('static', filename='vendor/css/rtl/core.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='vendor/css/rtl/theme-semi-dark.css') }}">

    <script src="{{ url_for('static', filename='vendor/libs/jquery/jquery.js') }}"></script>

    {% block styles %}
    {% endblock %}

    <style>
      .notifyjs-container {
        top: 60px; /* Adjust the top margin as needed */
      }
    </style>

  </head>

  <body>
    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar">
      <div class="layout-container">
        <!-- Menu -->

        <aside id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme">
          <div class="app-brand demo">
            <a href="javascript:void(0)" class="app-brand-link">
              <img src="{{ url_for('static', filename='img/logo.png') }}" class="app-brand-logo demo" alt="Logo" style="width: 35px; height: 35px;">
              <span class="app-brand-text demo menu-text fw-bold ms-2 text-wrap" style="font-size: 14pt;">ASSCAT NSTP<br>Management</span>
            </a>

            <a href="javascript:void(0);" class="layout-menu-toggle menu-link text-large ms-auto">
              <i class="bx menu-toggle-icon d-none d-xl-block fs-4 align-middle"></i>
              <i class="bx bx-x d-block d-xl-none bx-sm align-middle"></i>
            </a>
          </div>

          <div class="menu-divider mt-0"></div>

          <div class="menu-inner-shadow"></div>

          <ul class="menu-inner py-1">

            <li class="menu-item {{ 'active' if data.title == 'Batches' else '' }}">
              <a href="/head-batches/" class="menu-link">
                <i class="menu-icon tf-icons bx bx-spreadsheet"></i>
                <div>Batches</div>
              </a>
            </li>
            <li class="menu-item {{ 'active' if data.title == 'All Students' else '' }}">
              <a href="/head-students/" class="menu-link">
                <i class="menu-icon tf-icons bx bx-book-reader"></i>
                <div>All Students</div>
              </a>
            </li>
            
          </ul>
        </aside>
        <!-- / Menu -->

        <!-- Layout container -->
        <div class="layout-page">
          <!-- Navbar -->

          <nav class="layout-navbar navbar navbar-expand-xl align-items-center bg-navbar-theme" id="layout-navbar">
            <div class="container-fluid">
              <div class="layout-menu-toggle navbar-nav align-items-xl-center me-3 me-xl-0 d-xl-none">
                <a class="nav-item nav-link px-0 me-xl-4" href="javascript:void(0)">
                  <i class="bx bx-menu bx-sm"></i>
                </a>
              </div>

              <div class="navbar-nav-right d-flex align-items-center" id="navbar-collapse">
                <ul class="navbar-nav flex-row align-items-center ms-auto">

                  <!-- User -->
                  <li class="nav-item navbar-dropdown dropdown-user dropdown">
                    <a class="nav-link dropdown-toggle hide-arrow" href="javascript:void(0);" data-bs-toggle="dropdown">
                      <div class="avatar">
                        <img src="{{ url_for('static', filename='img/avatars/dp_default.png') }}" alt class="rounded-circle bg-white p-1" />
                      </div>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end">
                      <li>
                        <a class="dropdown-item" href="javascript:void(0);">
                          <div class="d-flex">
                            <div class="flex-shrink-0 me-3">
                              <div class="avatar">
                                <img src="{{ url_for('static', filename='img/avatars/dp_default.png') }}" alt class="rounded-circle bg-white p-1" />
                              </div>
                            </div>
                            <div class="flex-grow-1">
                              <span class="fw-semibold d-block lh-1">{{ session['user']['fname'].upper() }} {{ session['user']['lname'].upper() }}</span>
                              <small>Head - {{ session['user']['component'] }}</small>
                            </div>
                          </div>
                        </a>
                      </li>
                      <li>
                        <div class="dropdown-divider"></div>
                      </li>
                      <li>
                        <a class="dropdown-item changePassword" href="javascript:void(0);">
                          <i class="bx bx-lock me-2"></i>
                          <span class="align-middle">Change Password</span>
                        </a>
                      </li>
                      <li>
                        <a class="dropdown-item" href="/logout/" >
                          <i class="bx bx-power-off me-2"></i>
                          <span class="align-middle">Log Out</span>
                        </a>
                      </li>
                    </ul>
                  </li>
                  <!--/ User -->
                </ul>
              </div>

            </div>
          </nav>

          <!-- / Navbar -->

          <!-- Content wrapper -->
          <div class="content-wrapper">
            <!-- Content -->

            <div class="container-xxl flex-grow-1 container-p-y">
              {% block content %}
              {% endblock %}
            </div>
            <!-- / Content -->

            <!-- Footer -->
            <footer class="footer">
              <div class="container-fluid">
                <div class="row">
                  <div class="col-sm-6">
                    © 
                    <script>document.write(new Date().getFullYear())</script> 
                  </div>
                </div>
              </div>
            </footer>
            <!-- / Footer -->

          </div>
          <!-- Content wrapper -->
        </div>
        <!-- / Layout page -->
      </div>

      <!-- Overlay -->
      <div class="layout-overlay layout-menu-toggle"></div>

      <!-- Drag Target Area To SlideIn Menu On Small Screens -->
      <div class="drag-target"></div>
    </div>
    <!-- / Layout wrapper -->

    <div class="modal fade" id="modalChangePassword" tabindex="-1" aria-labelledby="modalChangePasswordLabel" aria-hidden="true">
        <div class="modal-dialog modal-sm modal-dialog-centered">
            <div class="modal-content">
                <form id="modalChangePasswordFormID" class="modal-content">
                    <input type="hidden" name="id" value="{{ data.id }}" placeholder="Enter instruction here..." />
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">Change Password</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">

                      <div class="mb-3 form-password-toggle">
                        <div class="d-flex justify-content-between">
                          <label class="form-label" for="opassword">Old Password <span class="text-danger">*</span></label>
                        </div>
                        <div class="input-group input-group-merge">
                          <input type="password" id="opassword" class="form-control" name="opassword" placeholder="&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;" aria-describedby="password" />
                          <span class="input-group-text cursor-pointer"><i class="bx bx-hide"></i></span>
                        </div>
                      </div>
                      <div class="mb-3 form-password-toggle">
                        <div class="d-flex justify-content-between">
                          <label class="form-label" for="password">New Password <span class="text-danger">*</span></label>
                        </div>
                        <div class="input-group input-group-merge">
                          <input type="password" id="password" class="form-control" name="password" placeholder="&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;" aria-describedby="password" />
                          <span class="input-group-text cursor-pointer"><i class="bx bx-hide"></i></span>
                        </div>
                      </div>
                      <div class="mb-3 form-password-toggle">
                        <div class="d-flex justify-content-between">
                          <label class="form-label" for="cpassword">Confirm New Password <span class="text-danger">*</span></label>
                        </div>
                        <div class="input-group input-group-merge">
                          <input type="password" id="cpassword" class="form-control" name="cpassword" placeholder="&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;" aria-describedby="password" />
                          <span class="input-group-text cursor-pointer"><i class="bx bx-hide"></i></span>
                        </div>
                      </div>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-sm btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" id="btnChangePassword" class="btn btn-sm btn-success">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    {% block modals %}
    {% endblock %}

    <!-- Core JS -->
    <script src="{{ url_for('static', filename='vendor/libs/popper/popper.js') }}"></script>
    <script src="{{ url_for('static', filename='vendor/js/bootstrap.js') }}"></script>
    <script src="{{ url_for('static', filename='vendor/libs/perfect-scrollbar/perfect-scrollbar.js') }}"></script>
    <script src="{{ url_for('static', filename='vendor/libs/hammer/hammer.js') }}"></script>
    <script src="{{ url_for('static', filename='vendor/libs/typeahead-js/typeahead.js') }}"></script>
    <script src="{{ url_for('static', filename='vendor/js/menu.js') }}"></script>
    <script src="{{ url_for('static', filename='vendor/libs/sweetalert2/sweetalert2.js') }}"></script>
    <script src="{{ url_for('static', filename='js/notify.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>

    <script>

      $(document).ready(function() {
        $('.changePassword').click(function() {
          $('#modalChangePassword').modal('show')
        })
      })

      function changePassword()
      {

        $('#modalChangePassword').modal('show')

      }

      $(document).on('submit', '#modalChangePasswordFormID', function(e) {
        e.preventDefault()

        var formData = new FormData(this) 
        $.ajax({
          url         : '/change-password/', 
          method      : 'PUT',
          data        : formData,
          dataType    : 'JSON',
          contentType : false, 
          processData : false, 
          beforeSend: function() {
            $('#modalChangePasswordFormID button[type="submit"]').prop('disabled', true)
          }
        })
        .done(function(res) {
          if (res.response.status == 200) {
            $('#modalChangePassword').modal('hide')
            $.notify("Password changed!", "success")
          } else {
            Swal.fire({
              title : res.response.name, 
              html  : res.response.message, 
              icon  : "warning" 
            })
          }
        })
        .fail(function(jqXHR, textStatus, errorThrown) {
          console.error('Error:', errorThrown) 
        })
        .always(function() {
          $('#modalChangePasswordFormID button[type="submit"]').prop('disabled', false)
        })
      })

    </script>

    {% block scripts %}
    {% endblock %}

  </body>
</html>
